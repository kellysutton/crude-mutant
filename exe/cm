#!/usr/bin/env ruby
# frozen_string_literal: true

require "crude-mutant"

file_to_mutate = ARGV[0]
test_command = ARGV[1]

CrudeMutant.start(file_to_mutate, test_command) do |progress|
  clear_string = ' ' * CrudeMutant::TerminalCalculator.new.calculate_length
  $stdout.print clear_string
  $stdout.print "\r"

  completed = "Completed #{progress.run_results.size}/#{progress.total_runs_to_perform}"
  average = "Average time per run: #{progress.avg_time.round(2)} second(s)"
  eta_time = (progress.total_runs_to_perform - progress.run_results.size) * progress.avg_time
  eta = "Estimated time of completion: #{eta_time.round(2)} seconds"
  $stdout.print "#{completed} #{average} #{eta}\r"
  $stdout.flush
end
